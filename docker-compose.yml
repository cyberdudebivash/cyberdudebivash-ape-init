# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CYBERDUDEBIVASH INDIVIDUAL UNICORN â€” SELF-HEALING CLUSTER
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
version: '3.8'

services:
  # ðŸš€ MAIN APPLICATION: Next.js + Supabase + Stripe
  cyberdudebivash-app:
    container_name: cyberdudebivash-app
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_SUPABASE_URL=${SUPABASE_URL}
      - NEXT_PUBLIC_SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
    restart: always
    networks:
      - ape-network

  # ðŸ›¡ï¸ THE GUARDIAN: Autonomous Platform Engineer Sidecar
  cyberdudebivash-ape-monitor:
    container_name: cyberdudebivash-ape-monitor
    image: python:3.9-slim
    volumes:
      # CRITICAL: This allows the monitor to talk to Docker directly
      - /var/run/docker.sock:/var/run/docker.sock:ro
      # Link the monitor script from your host to the container
      - ./cyberdudebivash_ape_monitor.py:/app/monitor.py
    working_dir: /app
    command: >
      sh -c "pip install docker && python monitor.py cyberdudebivash-app"
    depends_on:
      - cyberdudebivash-app
    restart: unless-stopped
    networks:
      - ape-network

networks:
  ape-network:
    name: cyberdudebivash-ape-network
    driver: bridge